---
phase: 01-scanner-source
plan: 01
type: execute
---

<objective>
Add source classification type and enhanced GitHub metadata fields to the project type system, and implement the GitHub API calls to fetch richer data for all repos.

Purpose: The type system is the foundation everything else builds on. Enhanced GitHub data (languages, topics, license, visibility, size) gives remote-only repos parity with local ones.
Output: Updated types.ts with new fields, updated github.ts with enhanced fetching.
</objective>

<execution_context>
@~/.claude/skills/create-plans/workflows/execute-phase.md
@~/.claude/skills/create-plans/templates/summary.md
</execution_context>

<context>
@.planning/BRIEF.md
@.planning/ROADMAP.md
@scanner/types.ts
@scanner/github.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend Project type with source and remote metadata fields</name>
  <files>scanner/types.ts</files>
  <action>
  Add a `ProjectSource` type: `'local-only' | 'remote-only' | 'synced'`.

  Add the following fields to the `Project` interface:
  - `source: ProjectSource` — classification of where this project lives
  - `visibility: 'public' | 'private' | null` — repo visibility from GitHub API
  - `languages: Record<string, number>` — language breakdown (bytes per language from GitHub Languages API)
  - `topics: string[]` — GitHub repo topics
  - `license: string | null` — SPDX license identifier
  - `sizeKB: number` — repo size in KB from GitHub API
  - `isArchived: boolean` — whether the repo is archived
  - `isFork: boolean` — whether the repo is a fork

  Add a `LocalRemoteDiff` interface:
  - `localBranch: string` — current local branch name
  - `remoteBranch: string` — default remote branch name
  - `aheadCount: number` — local commits ahead of remote
  - `behindCount: number` — local commits behind remote
  - `hasUncommittedChanges: boolean` — dirty working tree
  - `localOnlyBranches: string[]` — branches that exist locally but not on remote
  - `remoteOnlyBranches: string[]` — branches that exist on remote but not locally

  Add to the `Project` interface:
  - `diff: LocalRemoteDiff | null` — only populated when source is 'synced'

  Also update the `PartialProject` interface in github.ts to include: visibility, languages, topics, license, sizeKB, isArchived, isFork (these come from the GitHub API response).
  </action>
  <verify>npx tsc --noEmit (may have errors from unimplemented usages — that's expected at this stage, but the types file itself should be syntactically valid)</verify>
  <done>ProjectSource type exported, Project interface has source/visibility/languages/topics/license/sizeKB/isArchived/isFork/diff fields, LocalRemoteDiff interface exported, PartialProject has new GitHub metadata fields</done>
</task>

<task type="auto">
  <name>Task 2: Enhance GitHub API fetching with languages, topics, license, visibility, and size</name>
  <files>scanner/github.ts</files>
  <action>
  Update `transformRepoData()` to extract additional fields from the GitHub API response:
  - `visibility`: from `repo.visibility` or infer from `repo.private` (private=true → 'private', else 'public')
  - `sizeKB`: from `repo.size` (GitHub returns size in KB)
  - `isArchived`: from `repo.archived`
  - `isFork`: from `repo.fork`
  - `license`: from `repo.license?.spdx_id` (null if no license)
  - `topics`: from `repo.topics` (array of strings)
  - `languages`: initialize as empty `{}` (populated below)

  Update `fetchAllRepos()` to also request topics in the repo listing by adding the `Accept: application/vnd.github.mercy-preview+json` header to the Octokit constructor (or per-request). Note: topics may already be included in newer API versions — check the response first.

  Add a new exported function `fetchRepoLanguages(octokit, owner, repo): Promise<Record<string, number>>` that calls `octokit.repos.listLanguages({ owner, repo })` and returns the language map (e.g., `{ TypeScript: 45000, JavaScript: 12000 }`).

  In the `fetchAllRepos()` per-repo loop, add a call to `fetchRepoLanguages()` alongside the existing branches/pulls/commits calls. Assign the result to `partial.languages`.

  Update the `RepoData` interface to include the new fields: `private`, `archived`, `fork`, `size`, `license`, `topics`, `visibility`.

  Ensure the allRepos.push mapping also captures these new fields from the API response.
  </action>
  <verify>npx tsc --noEmit on scanner/github.ts shows no syntax errors in this file (downstream consumers may still error)</verify>
  <done>PartialProject includes visibility, languages, topics, license, sizeKB, isArchived, isFork. fetchRepoLanguages function exported. fetchAllRepos fetches and populates all new fields per repo.</done>
</task>

</tasks>

<verification>
Before declaring this plan complete:
- [ ] scanner/types.ts exports ProjectSource, LocalRemoteDiff, updated Project
- [ ] scanner/github.ts exports fetchRepoLanguages
- [ ] PartialProject has all new fields
- [ ] No syntax errors in either file
</verification>

<success_criteria>
- ProjectSource type and LocalRemoteDiff interface defined and exported
- Project interface extended with all new fields
- GitHub API fetching enhanced to retrieve languages, topics, license, visibility, size, archived, fork
- fetchRepoLanguages function implemented
</success_criteria>

<output>
After completion, create `.planning/phases/01-scanner-source/01-01-SUMMARY.md`
</output>
